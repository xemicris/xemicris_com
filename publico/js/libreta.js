$(document).ready((function(){var a;function e(){return date=new Date($("#calendario").val()),fecha=date.getFullYear()+"-"+("0"+(date.getMonth()+1)).slice(-2)+"-"+("0"+date.getDate()).slice(-2),fecha}function t(){var a=$(".movimientos");$.ajax({url:"ajax/mostrarMovimientos",type:"POST",dataType:"json",cache:!1,data:{validacion:"7jT@wq23_hzpML(?Jm",accion:"cargar"},beforeSend:function(){a.waitMe()}}).done((function(e){200===e.estatus&&0!=e.datos||200===e.estatus&&!1===e.datos.movimientos?a.html(e.datos):(toastr.error(e.mensaje,"¡Vaya!"),a.html(""))})).fail((function(e){toastr.error("Hubo un error en la petición","¡Vaya!"),a.html("")})).always((function(){a.waitMe("hide")}))}$(".agregarMovimiento").on("submit",(function(o){o.preventDefault();var n=$(".agregarMovimiento"),i=new FormData(n.get(0)),r=$("#tipo").val(),c=$("#descripcion").val(),d=$("#cantidad").val();if(fecha=e(),calendario=$("#calendario"),i.append("validacion","7jT@wq23_hzpML(?Jm"),i.append("accion","agregar"),i.append("fecha",fecha),"ninguno"===r)return void toastr.error("Selecciona un tipo","¡Vaya!");if(""===c||c.length<5)return void toastr.error("Introduce una descripción válida","¡Vaya!");if(""===d||d<=0||!d.match(/^[0-9.,]+$/))return void toastr.error("Introduce una cantidad válida","¡Vaya!");$.ajax({url:"ajax/agregarMovimiento",type:"post",dataType:"json",contentType:!1,processData:!1,cache:!1,data:i,beforeSend:function(){n.waitMe()}}).done((function(a){201===a.estatus?(toastr.success(a.mensaje,"¡Bien!"),n.trigger("reset"),t(),calendario.val("")):toastr.error(a.mensaje,"¡Vaya!")})).fail((function(a){toastr.error("Hubo un error en la petición","¡Vaya!")})).always((function(){n.waitMe("hide"),hcaptcha.reset(a)}))})),$("#calendario").on("change",(function(){var a=$(".movimientos"),t=e();$.ajax({url:"ajax/cambiarFecha",type:"POST",dataType:"json",cache:!1,data:{validacion:"7jT@wq23_hzpML(?Jm",accion:"cargar",fecha:t},beforeSend:function(){a.waitMe()}}).done((function(e){200===e.estatus&&0!=e.datos?a.html(e.datos):200===e.estatus&&!1===e.datos?a.html('<div class="d-flex justify-content-center mt-5"><p class="lead movimientos">No hay movimientos en esta fecha</p></div>'):(toastr.error(e.mensaje,"¡Vaya!"),a.html(""))})).fail((function(e){toastr.error("Hubo un error en la petición","¡Vaya!"),a.html("")})).always((function(){a.waitMe("hide")}))})),t(),$("body").on("click",".botonEditar",(function(a){var e=$(this).data("id"),t=$(".agregarMovimiento");formularioActualizar=$(".movimientosActualizar"),tituloFormulario=$(".tituloForm"),$.ajax({url:"ajax/mostrarMovimiento",type:"POST",dataType:"json",cache:!1,data:{validacion:"7jT@wq23_hzpML(?Jm",accion:"obtener",id:e},beforeSend:function(){formularioActualizar.waitMe()}}).done((function(a){var e;200===a.estatus?(formularioActualizar.html(a.datos),tituloFormulario.html("Actualizar movimiento"),t.hide(),formularioActualizar.show(),e={sitekey:"3a207611-e241-4389-bf30-693e0875dda9"},widgetId3=hcaptcha.render("movcapact",e)):toastr.error(a.mensaje,"¡Vaya!")})).fail((function(a){toastr.error("Hubo un error en la petición","¡Vaya!")})).always((function(){formularioActualizar.waitMe("hide")}))})),$("body").on("submit",".actualizarMovimiento",(function(a){a.preventDefault();var o=$(".actualizarMovimiento"),n=$(".agregarMovimiento");if(validacion="7jT@wq23_hzpML(?Jm",accion="actualizar",datos=new FormData(o.get(0)),tipo=$('select[name="tipo"]',o).val(),descripcion=$('input[name="descripcion"]',o).val(),cantidad=$('input[name="cantidad"]',o).val(),fecha=e(),calendario=$("#calendario"),datos.append("validacion",validacion),datos.append("accion",accion),datos.append("fecha",fecha),"ninguno"===tipo)return void toastr.error("Selecciona un tipo","¡Vaya!");if(""===descripcion||descripcion.length<5)return void toastr.error("Introduce una descripción válida","¡Vaya!");if(""===cantidad||cantidad<=0||!cantidad.match(/^[0-9.,]+$/))return void toastr.error("Introduce una cantidad válida","¡Vaya!");$.ajax({url:"ajax/actualizarMovimiento",type:"post",dataType:"json",contentType:!1,processData:!1,cache:!1,data:datos,beforeSend:function(){o.waitMe()}}).done((function(a){200===a.estatus?(toastr.success(a.mensaje,"¡Bien!"),o.trigger("reset"),o.remove(),n.show(),t(),calendario.val("")):toastr.error(a.mensaje,"¡Vaya!")})).fail((function(a){toastr.error("Hubo un error en la petición","¡Vaya!")})).always((function(){o.waitMe("hide")}))})),$("body").on("click",".botonCancelar",(function(a){$(this);var e=$(".movimientosActualizar"),t=$(".agregarMovimiento"),o=$(".tituloForm");e.hide(),t.show(),o.html("Agregar nuevo movimiento")})),$("body").on("click",".botonBorrar",(function(a){var e=$(this).data("id"),o=$(".movimientos"),n=$("#calendario");if(!confirm("¿Seguró que quieres borrarlo?"))return!1;$.ajax({url:"ajax/borrarMovimiento",type:"POST",dataType:"json",cache:!1,data:{validacion:"7jT@wq23_hzpML(?Jm",accion:"borrar",id:e},beforeSend:function(){o.waitMe()}}).done((function(a){200===a.estatus?(toastr.success(a.mensaje,"¡Bien!"),t(),n.val("")):toastr.error(a.mensaje,"¡Vaya!")})).fail((function(a){toastr.error("Hubo un error en la petición","¡Vaya!")})).always((function(){o.waitMe("hide")}))})),$("#opciones").on("submit",(function(a){a.preventDefault();var e=$("#opciones"),o=new FormData(e.get(0)),n=$("#impuestos").val(),i=$(".tipoMoneda"),r=$("#calendario");o.append("validacion","7jT@wq23_hzpML(?Jm"),o.append("accion","agregar"),n=n.trim();if(""===n||n<0||!n.match(/^[0-9.,]+$/))return void toastr.error("Introduce un porcentaje válido","¡Vaya!");$.ajax({url:"ajax/opciones",type:"post",dataType:"json",contentType:!1,processData:!1,cache:!1,data:o,beforeSend:function(){e.waitMe()}}).done((function(a){200===a.estatus||201===a.estatus?(toastr.success(a.mensaje,"¡Bien!"),t(),i.html(a.datos),r.val("")):toastr.error(a.mensaje,"¡Vaya!")})).fail((function(a){toastr.error("Hubo un error en la petición","¡Vaya!")})).always((function(){e.waitMe("hide"),hcaptcha.reset(widgetId2)}))})),widgetId2=hcaptcha.render("opcapguar",{sitekey:"32caa3a1-7e05-4b47-8cee-b14bcc22228d"}),a=hcaptcha.render("movcapagr",{sitekey:"1609275f-8661-4dbc-b636-eeaa36d39b86"})}));