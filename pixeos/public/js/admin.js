import{getProjectRoute}from"./getProjectRoutes.js";const server=getProjectRoute(),urlMostrar=`${server}/pixeos/admin/mostrarUsuarios`,urlEditar=`${server}/pixeos/admin/updateUser`,urlEliminar=`${server}/pixeos/admin/eliminateUser`,urlSelect=`${server}/pixeos/admin/selectRol`,contenedor=document.querySelector("#usuarios"),botonAdmin=document.querySelector("#botonAdmin");let fila,idUsuario,nombreValor,apellidosValor,correoValor,estado="",rolValor="";const modalAdmin=new bootstrap.Modal(document.getElementById("modalAdmin")),formulario=document.querySelector("form"),nombre=document.getElementById("nombre"),apellidos=document.getElementById("apellidos"),correo=document.getElementById("correo"),rol=document.getElementById("rol"),select=document.getElementById("confirmado");function usuario(e,t,o){const n=document.createElement("tr"),r=document.createElement("input");r.type="hidden",r.value=e.id;const d=document.createElement("td");d.textContent=e.nombre;const a=document.createElement("td");a.textContent=e.apellidos;const i=document.createElement("td");i.textContent=e.correo;const l=document.createElement("td");l.textContent=t;const c=document.createElement("td");c.textContent=o;const s=document.createElement("td");s.className="text-center";const m=document.createElement("div");m.className="d-flex justify-content-center gap-2";const u=document.createElement("a");u.className="btn-editar btn btn-sm btn-primary mt-2",u.textContent="Editar";const p=document.createElement("a");return p.className="btn-eliminar btn btn-sm btn-danger mt-2",p.textContent="Eliminar",n.appendChild(r),n.appendChild(d),n.appendChild(a),n.appendChild(i),n.appendChild(l),n.appendChild(c),m.appendChild(u),m.appendChild(p),s.appendChild(m),n.appendChild(s),n}function noUsuario(){const e=document.createElement("tr"),t=document.createElement("td");t.setAttribute("colspan",4);const o=document.createElement("h3");return o.textContent="No hay usuarios",e.appendChild(t),t.appendChild(o),e}function mostrarUsuarios(){fetch(urlMostrar,{method:"POST"}).then((e=>e.json())).then((e=>{if(0!=e.length){for(;contenedor.hasChildNodes();)contenedor.removeChild(contenedor.firstChild);e.forEach((e=>{estado="1"==e.confirmado?"Activado":"No activado","1"==e.rol?rolValor="Administrador":"2"==e.rol?rolValor="Usuario":"3"==e.rol&&(rolValor="Técnico"),contenedor.appendChild(usuario(e,rolValor,estado))}))}else{for(;contenedor.hasChildNodes();)contenedor.removeChild(contenedor.firstChild);contenedor.appendChild(noUsuario())}}))}mostrarUsuarios();const on=(e,t,o,n)=>{e.addEventListener(t,(e=>{e.target.closest(o)&&n(e)}))};function confirmado(e){for(;select.hasChildNodes();)select.removeChild(select.firstChild);const t=document.createElement("option");t.setAttribute("value",1),t.textContent="Activado";const o=document.createElement("option");return o.setAttribute("value",0),o.textContent="No activado","1"==e?t.setAttribute("selected",""):"0"==e&&o.setAttribute("selected",""),select.appendChild(t),select.appendChild(o),select}function roles(e){for(;rol.hasChildNodes();)rol.removeChild(rol.firstChild);const t=document.createElement("option");t.setAttribute("value",1),t.textContent="Administrador";const o=document.createElement("option");o.setAttribute("value",2),o.textContent="Usuario";const n=document.createElement("option");return n.setAttribute("value",3),n.textContent="Técnico","1"===e?t.setAttribute("selected",""):"2"===e?o.setAttribute("selected",""):"3"===e&&n.setAttribute("selected",""),rol.appendChild(t),rol.appendChild(o),rol.appendChild(n),rol}on(document,"click",".btn-editar",(e=>{const t=e.target.parentNode.parentNode.parentNode;idUsuario=t.children[0].value,nombreValor=t.children[1].textContent,apellidosValor=t.children[2].textContent,correoValor=t.children[3].textContent,nombre.value=nombreValor,apellidos.value=apellidosValor,correo.value=correoValor,botonAdmin.textContent="Guardar";const o=new FormData;o.append("idUsuario",idUsuario),fetch(urlSelect,{method:"POST",mode:"cors",cache:"no-cache",body:o}).then((e=>e.json())).then((e=>{confirmado(e.confirmado),roles(e.rol),modalAdmin.show()}))})),botonAdmin.addEventListener("click",(()=>{const e=new FormData(formulario);e.append("idUsuario",idUsuario),fetch(urlEditar,{method:"POST",mode:"cors",cache:"no-cache",body:e}).then((e=>e.json())).then((e=>{"Nombre requerido"!=e&&"Nombre incorrecto"!=e&&"Apellidos requeridos"!=e&&"Apellidos incorrectos"!=e&&"Correo requerido"!=e&&"El correo electrónico no es válido"!=e?"Nombre requerido"!=e[0]&&"Apellidos incorrectos"!=e[1]?(Swal.fire({icon:"success",title:"Usuario modificado correctamente",showConfirmButton:!1,timer:1500}),modalAdmin.hide(),mostrarUsuarios()):(Swal.fire({icon:"error",title:"Ha habido un error",text:e[0]+" y "+e[1]}),modalTarea.hide()):(Swal.fire({icon:"error",title:"Ha habido un error",text:e}),modalTarea.hide())}))})),on(document,"click",".btn-eliminar",(e=>{const t=e.target.parentNode.parentNode.parentNode.firstElementChild.value,o=new FormData;o.append("idUsuario",t),Swal.fire({title:"¿Seguro que quieres eliminar la tarea",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si!",cancelButtonText:"No"}).then((e=>{e.isConfirmed&&fetch(urlEliminar,{method:"POST",mode:"cors",cache:"no-cache",body:o}).then((e=>e.json())).then((e=>{e?(Swal.fire("Usuario eliminado correctamente!"),mostrarUsuarios()):Swal.fire("Usuario no eliminado!")}))}))}));